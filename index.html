<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <link rel="stylesheet" href="popup.css">
</head>
<body>
<h1>동양-완성</h1>
<button class="modal-btn" onclick="openModal('#modla1')">1번 팝업</button>
<!-- [팝업] 스크래핑(서류 제출 자동화 서비스 이용동의서) -->
<div id="modla1" class="dy-modal">
    <div class="dy-modal-content">
        <div class="dy-header">
            <h5>스크래핑(서류 제출 자동화)<br class="only-mobile">서비스 이용 동의서</h5>
            <button type="button" class="dy-close-btn close" onclick="closeModal('#modla1')"><span class="blind-txt">닫기</span></button>
        </div>
        <div class="dy-body">
            <!-- 1. [입력전 동의]  -->
            <div  data-step="step1" style="display:block;">
                <p class="rgl-txt">
                    동양저축은행 귀중 ㈜<br>
                    동양저축은행과의 금융거래와 관련하여 동양저축은행이 진행하고자 하는 스크래핑 서비스에 대하여 본인의 이용 동의가 필요합니다.
                </p>
                <p class="emp-txt mt-rgl">※ 스크래핑(서류 제출 자동화) 서비스 이용 정의</p>
                <p class="sm-txt mt-sm">동양저축은행  의 대출 상품을 이용 시 별도로 서류 발급기관(국가및  공공기관 등)에 방문하여 인적 사항/소득/재직 등 관련 서류를 발급받아 동양저축은행에 제출하는 번거로움을 없애고자, 동양저축은행 홈페이지에서 본인의 스크래핑 동의를 받아 발급받고자 하는 서류를 발급기관에 자동으로 접속하여 전자적 방식으로 제출하는 서비스</p>
                <div class="dy-custom-table">
                    <table>
                        <tr>
                            <th><div class="dy-th-wrap">수집이용<br class="only-mobile"> · 목적</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <ul class="dy-dot-list">
                                        <li>대출 심사에 필요한 서류 제출의 편의성 제공 </li>
                                        <li>고객정보(본인 진위 여부소득직업 등) 판단을 위한 자료로 활용</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><div class="dy-th-wrap">제공·조회 <br class="only-mobile">대상 기관</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <ul class="dy-dot-list">
                                        <li>정부24, 국세청, 국민건강보험공단 등</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><div class="dy-th-wrap">수집 이용할 <br class="only-mobile">항목</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <ul class="dy-dot-list">
                                        <li>정부24 : 주민등록등본, 주민등록초본 </li>
                                        <li>건강보험관리공단 : 건강보험자격득실확인서, 건강보험납부확인서 </li>
                                        <li>국세청 : 소득금액증명원</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><div class="dy-th-wrap">제공받는 자</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <ul class="dy-dot-list">
                                        <li>동양저축은행</li>
                                        <li>스크래핑 공급계약업체 : ㈜쿠콘</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><div class="dy-th-wrap">보유이용<br class="only-mobile"> · 기간</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <ul class="dy-dot-list">
                                        <li>(금융)거래 종료*로부터 5년까지 보유이용 </li>
                                        <li>금융거래 종료일 후에는 금융사고 조사, 분쟁 해경, 민원 처리, 법령상 의무이행 및 당사의 리스크 관리 업무만을 위하여만 보유이용 </li>
                                        <li class="dy-imp">금융거래 종료일이란 당행과 거래 중인 모든 계약(여·수신) 및 서비스 (인터넷뱅킹 포함 전자 금융거 래 등)가 종료한 날을 뜻함</li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div>
                    <ul class="dy-star-list">
                        <li>
                            동의를 거부할 권리 및 동의를 거부할 경우 : 스크래핑 서비스는 비대면 채널에서 상품 및 서비스를 제공해드리기 위한 과정입니다.<br>
                            본 스크래핑 서비스의 이용을 원하지 않는 경우 우편이나 팩스를 통해 실물 서류를 제출하는 방식으로 진행이 가능하고, 동양저축은 (062-720-0850)을 통해 서류 제출에 대해 안내 받으시기를 바랍니다.</li>
                        <li>
                            유의 사항<br>
                            발급·이용 기관의 이용 제한전산장애 등이 발생할 경우 서비스 제공이 제한될 수 있습니다.<br>
                            본 스크래핑 정보는 동양저축은행 상품 이용을 위한 용도로만 제한적으로 이용됩니다.
                        </li>
                    </ul>
                </div>
                <div class="dy-button-wrap">
                    <button type="button" class="cm_btn" data-step="step1" onclick="showNextStep('step1','step2')">스크래핑(서류 제출 자동화) 서비스 <br class="only-mobile">이용 동의하고 신청자 정보 입력하기</button>
                </div>
            </div>
            <!-- 2. [입력과정] -->
            <div  data-step="step2" style="display: none;">
                <p class="rgl-txt">
                    스크래핑(서류 제출 자동화) 서비스를 통해 귀하의 대출 신청 과정을 더욱 편리하고 신속하게 진행할 수 있습니다.<br>
                    이 서비스는 서류 제출 시간을 90% 단축하고 대출 심사 속도를 2배 높이며, 실수로 인한 서류 누락을 방지합니다.
                </p>
                <ul class="dy-dot-list mt-rgl mt-ver">
                    <li>귀하의 개인정보는 암호화되어 안전하게 전송되며, 오직 대출 상품 이용 목적으로만 사용됩니다.</li>
                    <li>본 서비스는 선택 사항이며, 원하지 않으시면 우편이나 팩스로 서류를 제출하실 수 있습니다.</li>
                    <li>동의 후에도 언제든지 철회가 가능합니다.</li>
                    <li>다만, 발급기관의 전산장애 시 일시적으로 서비스가 제한될 수 있습니다.</li>
                    <li>서비스 이용에 관한 문의사항은 062-720-0850으로 연락 주시기 바랍니다.</li>
                </ul>
                <!-- 진행정도 표시 -->
                <div class="dy-process-wrap mt-lg">
                    <!-- dy-process-finish(완료), dy-process-ing(진행중-현재단계) -->
                    <ul class="dy-num-list">
                        <li class="dy-process-ing" data-step="p-step1">
                            <span class="dy-num">1</span>
                            <span class="dy-txt">성명</span>
                        </li>
                        <li data-step="p-step2">
                            <span class="dy-num">2</span>
                            <span class="dy-txt">생년월일</span>
                        </li>
                        <li data-step="p-step3">
                            <span class="dy-num">3</span>
                            <span class="dy-txt">주민등록<br class="only-mobile">번호</span>
                        </li>
                        <li data-step="p-step4">
                            <span class="dy-num">4</span>
                            <span class="dy-txt">휴대전화 <br class="only-mobile">번호</span>
                        </li>
                        <li data-step="p-step5">
                            <span class="dy-num">5</span>
                            <span class="dy-txt">주소</span>
                        </li>
                    </ul>
                </div>
                <form class="dy-custom-table mt-md">
                    <table data-table="modal_scaping_service_agreement">
                        <!-- 1. 성명 입력시 다음 버튼 클릭 -->
                        <tr data-step="p-step1">
                            <th><div class="dy-th-wrap">성명</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <div class="dy-input-box size-rgl">
                                        <input id="dy-name" type="text" placeholder="성명을 입력하세요"/>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- 성명 입력후 다음 버튼 클릭시 제시됨 -->
                        <tr data-step="p-step2">
                            <th><div class="dy-th-wrap">생년월일</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <!--                                        <input id="dy-birth" class="calendar-ver" type="text" oninput="this.value = this.value.replace(/[^0-9]/g, '')" maxlength="8" placeholder="* 8자리 기입, 예시 : 19990909"/>-->
                                    <label class="dy-input-box  size-rgl">
                                        <input id="dy-birth" class="calendar-ver" type="text"  placeholder="* 8자리 기입, 예시 : 19990909" style="text-align:left!important;-webkit-appearance: none!important;"/>
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <!-- 생년월일 입력 후 다음 버튼 클릭시 주민등록번호 제시됨 -->
                        <tr data-step="p-step3">
                            <th><div class="dy-th-wrap">주민등록번호</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <div class="dy-input-wrap">
                                        <div class="dy-input-box size-sm w-50">
                                            <input  id="dy-id-card1"  type="text" oninput="this.value = this.value.replace(/[^0-9]/g, '')"maxlength="6" placeholder=""/>
                                        </div>
                                        <span style="color:#8c8d8d;">-</span>
                                        <div class="dy-input-box size-sm w-50">
                                            <input id="dy-id-card2" type="password" oninput="this.value = this.value.replace(/[^0-9]/g, '')" maxlength="7" placeholder=""/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- 주민등록번호 입력 후 버튼 클릭시 휴대전화번호 제시됨 -->
                        <tr data-step="p-step4">
                            <th><div class="dy-th-wrap">휴대전화번호</div></th>
                            <td>
                                <div class="dy-td-wrap">
                                    <div class="dy-input-wrap">
                                        <div class="dy-input-box size-xsm">
                                            <select id="dy-phone-num1">
                                                <option value="010" selected>010</option>
                                                <option value="옵션1">옵션1</option>
                                                <option value="옵션2">옵션2</option>
                                            </select>
                                        </div>
                                        <span style="color:#8c8d8d;">-</span>
                                        <div class="dy-input-box size-sm w-sp2">
                                            <input id="dy-phone-num2" type="text" oninput="this.value = this.value.replace(/[^0-9]/g, '')"  maxlength="4" placeholder=""/>
                                        </div>
                                        <span style="color:#8c8d8d;">-</span>
                                        <div class="dy-input-box size-sm w-sp2">
                                            <input  id="dy-phone-num3" type="text" oninput="this.value = this.value.replace(/[^0-9]/g, '')" maxlength="4" placeholder=""/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- 주소 입력 후 다음 버튼 클릭시 주소가 제시됨 -->
                        <tr data-step="p-step5">
                            <th><div class="dy-th-wrap">주소</div></th>
                            <td>
                                <div class="dy-td-wrap col-ver">
                                    <div class="dy-input-wrap">
                                        <div class="dy-input-box size-lg w-sp1">
                                            <!-- readonly 필요 -->
                                            <input  id="dy-address1" type="text" placeholder="" />
                                        </div>
                                        <div class="dy-input-box size-sm">
                                            <button type="button" class="cm_sim_btn">검색</button>
                                        </div>
                                    </div>
                                    <div class="dy-input-wrap">
                                        <div class="dy-input-box">
                                            <input id="dy-address2" type="text" placeholder=""/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </form>
                <div>
                    <ul class="dy-star-list">
                        <li>입력하신 정보가 정확하지 않을 경우 스크래핑(서류 제출 자동화) 서비스 이용이 제한될 수 있습니다.</li>
                    </ul>
                </div>
                <div class="dy-button-wrap">
                    <!--                    <button id="goNext" type="button" class="cm_btn size-sm"  onclick="goNext()">다음</button>-->
                    <!-- 주소까지 모두 입력되었을때 제시되는 버튼, 클릭시 성공 얼럿창 -->
                    <button id="submitAgreement" type="submit" class="cm_btn size-sm" style="display:none;" onclick="submitAgreementData('#modla1')">신청자 정보 제출하기</button>
                </div>
            </div>
            <!-- 3. [제출후]  -->
            <div  data-step="step3" style="display:none;">
                <div class="dy-confirm-wrap">
                    <p class="lg-txt mt-md text-align-r1">
                        스크래핑 서비스 이용 동의 및 개인정보 입력이 완료되었습니다.<br>
                        귀하의 대출 신청을 위한 서류 제출 절차가 성공적으로 접수되었습니다.<br>
                        입력하신 정보를 바탕으로 신속하게 심사를 진행하겠습니다.
                    </p>
                    <div class="dy-image-box">
                        <img src="dy_character.png" alt="">
                    </div>
                    <ul class="dy-dot-list mt-ver">
                        <li>제출하신 정보는 안전하게 보호되며, 대출 심사 목적으로만 사용됩니다.</li>
                        <li>추가 서류가 필요한 경우 별도로 연락 드리겠습니다.</li>
                    </ul>
                    <p class="rgl-txt text-align-r1 mt-md">
                        문의사항이 있으시면 062-720-0850으로 연락 주시기 바랍니다.<br>
                        동양저축은행을 이용해 주셔서 감사합니다.
                    </p>
                </div>

                <div class="dy-button-wrap">
                    <button id="confirm" type="button" class="cm_btn size-sm"  onclick="closeModal('#modla1')">확인</button>
                </div>
            </div>
            <!-- 4. [에러] -->
            <div id="dy-error" style="display:none;">
                <div class="dy-confirm-wrap">
                    <p class="lg-txt mt-md text-align-r1">
                        죄송합니다.<br>
                        요청하신 페이지를 찾을 수 없습니다.
                    </p>
                    <p class="rgl-txt text-align-r1 mt-sm2">
                        찾으시는 페이지의 주소가 잘못 입력되었거나, 페이지의 주소가 변경, 삭제되어 요청하신 페이지를 찾을 수 없습니다.<br>
                        주소를 다시 한번 확인하여 주시기 바랍니다.
                    </p>
                    <div class="dy-image-box">
                        <img src="dy_character_error.png" alt="">
                    </div>
                    <p class="rgl-txt text-align-r1 mt-md">
                        문의사항이 있으시면 062-720-0850으로 연락 주시기 바랍니다.<br>
                        동양저축은행을 이용해 주셔서 감사합니다.
                    </p>
                </div>

                <div class="dy-button-wrap twin-ver">
                    <button type="button" class="cm_btn size-sm"  onclick="backStep('#modla1')">이전</button>
                    <button type="button" class="cm_sim_btn size-auto"  onclick="closeModal('#modla1')">확인</button>
                </div>
            </div>
            <!-- 5. [로딩] -->
            <div id="dy-loading" style="display:none;">
                <div class="dy-confirm-wrap">
                    <p class="lg-txt mt-md text-align-r1">
                        추가 인증을 위해 화면 이동중입니다.<br>
                        잠시만 기다려주세요
                    </p>
                    <div class="dy-image-box ani-ver">
                        <img src="dy_character_loading.png" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- // 팝업추가 -->
</body>
</html>
<script>
  /* 데이트피커 임시 */
  document.addEventListener('DOMContentLoaded', function() {
    flatpickr("#dy-birth", {
      dateFormat: "Y-m-d",       // 내부적으로 사용하는 날짜 형식
      minDate: "1900-01-01",     // 최소 날짜
      maxDate: "today",          // 최대 날짜 (오늘까지 선택 가능)
      locale: "ko",              // 한국어 로케일 설정
      onChange: function(selectedDates, dateStr, instance) {
        // 날짜 형식을 'YYYYMMDD'로 변환
        const formattedDate = instance.formatDate(selectedDates[0], "Ymd");
        instance.value = formattedDate; // 입력 필드에 'YYYYMMDD' 형식으로 업데이트
        if(validateStep(this)) {
          goNext(currentActiveStep);
        }
      }
    });
  });
  /*mobiscroll.localeKo = {
    dateFormat: 'yyyy-mm-dd',
    dayNames: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'],
    dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
    monthNames: [
      '1월', '2월', '3월', '4월', '5월', '6월',
      '7월', '8월', '9월', '10월', '11월', '12월'
    ],
    monthNamesShort: [
      '1월', '2월', '3월', '4월', '5월', '6월',
      '7월', '8월', '9월', '10월', '11월', '12월'
    ],
    today: '오늘',
    cancelText: '취소',
    setText: '확인'
  };
  mobiscroll.datepicker('#dy-birth', {
    theme: 'ios',
    display: 'center',
    dateFormat: 'YYYY-MM-DD',
    max: new Date(),
    locale: mobiscroll.localeKo
  });*/
  /*jQuery(function($){
    $.datepicker.regional["ko"] = {
      closeText: "닫기",
      prevText: "이전달",
      nextText: "다음달",
      currentText: "오늘",
      monthNames: ["1월(JAN)","2월(FEB)","3월(MAR)","4월(APR)","5월(MAY)","6월(JUN)", "7월(JUL)","8월(AUG)","9월(SEP)","10월(OCT)","11월(NOV)","12월(DEC)"],
      monthNamesShort: ["1월","2월","3월","4월","5월","6월", "7월","8월","9월","10월","11월","12월"],
      dayNames: ["일","월","화","수","목","금","토"],
      dayNamesShort: ["일","월","화","수","목","금","토"],
      dayNamesMin: ["일","월","화","수","목","금","토"],
      weekHeader: "Wk",
      dateFormat: "yymmdd",
      firstDay: 0,
      isRTL: false,
      showMonthAfterYear: true,
      yearSuffix: ""
    };
    $.datepicker.setDefaults($.datepicker.regional["ko"]);

    $("#dy-birth").datepicker({
      showAnim: "slideDown",
      changeMonth: true,
      changeYear: true,
      maxDate: 0 , // 오늘 날짜
      yearRange: "1900:" + new Date().getFullYear(),
      onSelect: function(dateText) {
        if(validateStep(this)) {
          goNext(currentActiveStep);
        }
      },
      beforeShow: function(input, inst) {
        // 모바일 화면에서 Datepicker 위치 강제 조정
        setTimeout(function() {
          inst.dpDiv.css({
            top: $(input).offset().top + $(input).outerHeight(),
            left: $(input).offset().left,
            position: "absolute"
          });
        }, 0);
      }
    });
  });*/
  /*new Pikaday({
    field: document.getElementById('dy-birth'),
    format: 'YYYY-MM-DD', // PHP와 호환 가능한 날짜 형식
    i18n: {
      previousMonth: '이전 달',
      nextMonth: '다음 달',
      months: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
      weekdays: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'],
      weekdaysShort: ['일', '월', '화', '수', '목', '금', '토']
    }
  });*/
  /* 20250115 팝업 */
  /* ---- [팝업 공통 변수] ---------------------------------------------------------- */
  let openModalName = '' // 열린 팝업이름 저장
  let modals = document.getElementsByClassName('dy-modal');
  /* ---- [팝업 개별 변수] ---------------------------------------------------------- */
  /* 1. [팝업명] 스크래핑(서류 제출 자동화) 서비스 이용 동의서 : 관련 변수 저장 */
  let currentActiveStep = 'p-step1';
  /* 유효성 검사 */
  const stepMapping = {
    1: ['name'],
    2: ['birth'],
    3: ['id-card1', 'id-card2'],
    4: ['phone-num1', 'phone-num2', 'phone-num3'],
    5: ['address1', 'address2'],
  };
  const inputAlertMapping = {
    'dy-name' : '이름',
    'dy-birth' : '생년월일',
    'dy-id-card1' : '주민등록번호',
    'dy-id-card2' : '주민등록번호',
    'dy-phone-num1' : '휴대전화번호',
    'dy-phone-num2' : '휴대전화번호',
    'dy-phone-num3' : '휴대전화번호',
    'dy-address1':'주소',
    'dy-address2':'주소',
  }
  let resultPopupArgreementData = {}; // 전달할 데이터 저장

  /* ---- [팝업 공통 함수] ---------------------------------------------------------- */
  /* 외부 클릭시 팝업 닫힘 */
  window.onclick = function(event) {
    if (event.target.classList.contains('dy-modal')) {
      for (let modal of modals) {
        if (typeof modal.style !== 'undefined') {
          modal.style.display = 'none';
        }
      }
      closeModal(openModalName);
    }
  }
  /* Escape 버튼 누를 시 팝업 닫힘 */
  window.onkeydown = function(event) {
    if (event.key == 'Escape') {
      for (let modal of modals) {
        modal.style.display = 'none';
      }
      closeModal(openModalName);
    }
  }
  /* 윈도우 리사이즈 시 : 팝업창 높이 다시잡기 실행 */
  window.addEventListener('resize', function () {
    adjustPopupHeight('#modla1');
  });

  /* 모달창 열기 */
  function openModal (modalName) {
    openModalName = modalName
    document.querySelector(modalName).style.display = 'flex';
    adjustPopupHeight(modalName);
    document.body.style.overflow = 'hidden';
  }
  /* 모달창 닫기 */
  function closeModal(modalName) {
    const modalElement = document.querySelector(modalName);
    if (modalElement) { // 해당 요소가 존재하는지 확인
      /* [공통 기능] */
      modalElement.style.display = 'none';
      document.body.style.overflow = 'auto';
      currentActiveStep = 'p-step1'
      openModalName = ''

      /* [개별 기능]] */
      /* 1. [팝업명] 스크래핑(서류 제출 자동화) 서비스 이용 동의서  */
      if(modalName === '#modla1') {
        currentActiveStep = 'p-step1';
        document.querySelector(`[data-step="step1"]`).style.display='block';
        document.querySelector(`[data-step="step2"]`).style.display='none';
        document.querySelector("[data-step='step3']").style.display = 'none';
        document.querySelector('#submitAgreement').style.display = 'none';
        document.querySelector("#dy-error").style.display = 'none';
        resetSteps('modal_scaping_service_agreement');
      }
    }
  }
  /* ------------------------------------------------------------------------------- */

  /* ---- [팝업] : '스크래핑(서류 제출 자동화) 서비스 이용 동의서' 관련 함수 -- */
  /* popup - 높이 잡기(반응형, 모바일 하단 바 고려) */
  function adjustPopupHeight(modalName) {
    const iw = window.innerWidth;
    const popup = document.querySelector(modalName);
    const modalContent = popup.querySelector('.dy-modal-content');
    const modalBody = modalContent.querySelector(`.dy-body`);

    if (iw <= 1440) {
      const vh = window.innerHeight * 0.01;
      modalContent.style.height = `${100 * vh}px`;
      modalContent.style.maxHeight = 'initial'; // 기존 스타일 초기화
      modalBody.style.height = `calc(${100 * vh}px - 144px)`;
    } else {
      modalContent.style.height = 'auto';
      modalContent.style.maxHeight = '850px';
      modalBody.style.height = `598px`;
    }
  }

  /* popup - 팝업 안의 내용 */
  function showNextStep(currentStep,nextStep) {
    // Step 1일 때만 현재 스텝 숨기기
    if (currentStep === 'step1') {
      document.querySelector(`[data-step="${currentStep}"]`).style.display='none';
    }
    // 다음 스텝 보이기
    setTimeout(function() {
      if (nextStep) {
        document.querySelectorAll(`[data-step="${nextStep}"]`).forEach(element => {
          element.style.display = 'block';
        });
        if(nextStep === 'step2') {
          document.querySelector(`tr[data-step="p-step1"]`).style.display='block';
        }
      }
    },10)
  }
  function goNext(activeStep) {
    activeStep = currentActiveStep
    let parts = activeStep.split(/(\d+)/);
    let step = parseInt(parts[1]);// 데이터를 저장할 객체

    // 현재 단계와 이전 모든 단계가 유효한지 검사하고 데이터 저장
    if (step <= 5) {
      for (let i = 1; i <= step; i++) {
        const inputs = stepMapping[i];
        resultPopupArgreementData[`step${i}`] = {}; // 단계별 데이터를 저장할 객체 초기화

        for (let j = 0; j < inputs.length; j++) {
          const inputId = `dy-${inputs[j]}`;
          const inputElement = document.querySelector(`[data-step="p-step${i}"] #${inputId}`);

          if (!inputElement || !inputElement.value) {
            // alert(`"${inputAlertMapping[inputId]}" 을/를 입력해주세요`);
            return;
          }

          // 데이터를 resultPopupArgreementData 객체에 저장
          resultPopupArgreementData[`step${i}`][inputs[j]] = inputElement.value;
        }
      }
    }
    document.querySelectorAll(`ul.dy-num-list li[data-step="p-step${step}"]`).forEach(element => {
      element.classList.remove('dy-process-ing');
      element.classList.add('dy-process-finish');
      let dyNumElement = element.querySelector('.dy-num');
      if(dyNumElement) dyNumElement.textContent = '';
    });

    let nextStep = step + 1; // 기존 값 + 1 = 다음 step
    /* 다음 버튼 클릭시 data-step 활성화를 위한 코드 */
    if(nextStep !== 6) {
      currentActiveStep = `p-step${nextStep}`;
      document.querySelectorAll(`[data-step="${currentActiveStep}"]`).forEach(element => {
        element.style.display = 'block';
      });
      document.querySelectorAll(`ul.dy-num-list li[data-step="${currentActiveStep}"]`).forEach(element => {
        element.classList.add('dy-process-ing');
      });
      /* step5 일경우 다음에 보여야 할 버튼 : 제출버튼으로 변경 */
      if(nextStep === 5) {
        document.querySelector('#submitAgreement').style.display = 'flex';
      }
    }
  }
  function completeSteps() {
    alert('모든 스텝이 완료되었습니다!');
  }
  /* popup - 닫혔을 시 초기화 기능 */
  function resetSteps(tableName) {
    let steps = document.querySelectorAll("ul.dy-num-list li");
    steps.forEach((element, index) => {
      // Remove 'dy-process-ing' if it exists
      if (element.classList.contains('dy-process-ing')) {
        element.classList.remove('dy-process-ing');
      }

      // Remove 'dy-process-finish' if it exists
      if (element.classList.contains('dy-process-finish')) {
        element.classList.remove('dy-process-finish');
      }

      // Reset the numbering in 'dy-num' classed elements
      let dyNumElement = element.querySelector(".dy-num");
      if (dyNumElement !== null) {
        dyNumElement.textContent = index + 1;  // number starts from 1
      }

      // Add 'dy-process-ing' to the first element
      if (index === 0) {
        element.classList.add('dy-process-ing');
      }
    });
    document.querySelectorAll(`table[data-table="${tableName}"] tr[data-step]`).forEach(tr => {
      tr.style.display = "none";

      let inputElements = tr.querySelectorAll("input");
      inputElements.forEach(inputEl => {
        inputEl.value = "";   // Clearing the input value
      });
      /* 임시!!! */
      // document.querySelector(`[data-step="p-step4"] #dy-address1 `).value='우편주소려나..'

      let selectElements = tr.querySelectorAll("select");
      selectElements.forEach(selectEl => {
        selectEl.value = "010";  // Setting the select value to 010
      });
    });
  }
  /* popup - input 작성시 다음단계 입력창 보임 관련 기능 */
  window.onload = function() {
    var inputs = document.querySelectorAll('table[data-table="modal_scaping_service_agreement"] input');

    for(var i = 0; i < inputs.length; i++) {
      inputs[i].addEventListener('input', function(e) {
        if(validateStep(currentActiveStep)) { // 각 단계의 입력이 유효하면 다음 단계로 넘어감
          goNext(currentActiveStep);
        }
      });
    }
  }
  /* popup - validation (유효성검사) */
  function validateInput(input) {
    // 이곳에서 필요한 입력 검증을 수행
    // 지금은 간단히 값의 존재 여부만을 검사하지만, 필요에 따라 다른 검사를 추가할 수 있음
    if(input.id === 'dy-name'){
      return input.value.trim().length >= 2;
    } else if (input.id === 'dy-birth') {
      return input.value.trim().length >= 8;
    } else if (input.id === 'dy-id-card1') {
      return input.value.trim().length >= 6;
    } else if (input.id === 'dy-id-card2') {
      return input.value.trim().length >= 7;
    }  else if (input.id === 'dy-phone-num1') {
      return input.value.trim().length >= 3;
    } else if(input.id === 'dy-phone-num2') {
      return input.value.trim().length >= 3;
    } else if(input.id === 'dy-phone-num3') {
      return input.value.trim().length >= 4;
    } else if (input.id === 'dy-address1') {
      return input.value.trim().length >= 1;
    } else if (input.id === 'dy-address2') {
      return input.value.trim().length >= 1;
    }
  }
  function validateStep(step) {
    let inputs = document.querySelectorAll(`[data-step="${step}"] input`);
    for(let i = 0; i < inputs.length; i++) {
      if(!validateInput(inputs[i])) {
        return false;
      }
    }
    return true;
  }

  /* popup - 관련 버튼 모음 */
  /* popup - 데이터 제출 */
  function submitAgreementData (modalName) {
    modalName =  document.querySelector(modalName)
    var inputs = modalName.querySelectorAll('table[data-table="modal_scaping_service_agreement"] input');
    var invalidInput = null;

    for(var i = 0; i < inputs.length; i++) {
      var input = inputs[i];
      if(!validateInput(input)) { // validateInput 함수는 입력 값을 검증하고, 이것이 유효할 때만 true를 반환
        invalidInput = input;
        break;
      }
    }

    if(invalidInput) {
      const fieldLabel = inputAlertMapping[invalidInput.id] || invalidInput.id;
      alert(`"${fieldLabel}" 값을 입력해주세요`);
      return;
    } else {
      /* 제출 데이터 */
      console.log('제출할 데이터');
      console.log(resultPopupArgreementData);
      /* 제충 성공화면 노출 */
      modalName.querySelector("[data-step='step2']").style.display = 'none'
      modalName.querySelector("[data-step='step3']").style.display = 'block'

      /* 에러 화면 노출 */
      /*modalName.querySelector("[data-step='step2']").style.display = 'none'
      modalName.querySelector("#dy-error").style.display = 'block';*/
    }
  }
  /* popup - 이전으로 돌아가기 버튼 */
  function backStep(modalName) {
    modalName =  document.querySelector(modalName)
    modalName.querySelector("[data-step='step1']").style.display = 'none'
    modalName.querySelector("[data-step='step2']").style.display = 'block'
    modalName.querySelector("[data-step='step3']").style.display = 'none';
    modalName.querySelector("#dy-error").style.display = 'none';
  }
  /* ------------------------------------------------------------------------------- */
</script>